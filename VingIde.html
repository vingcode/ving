<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VingIde - Web IDE for Ving</title>
  <style>
    :root {
      color-scheme: dark;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      background: #0e1116;
      color: #f5f6f7;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 20px 32px;
      border-bottom: 1px solid #1f242d;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #11161d;
    }
    header h1 {
      margin: 0;
      font-size: 1.6rem;
      letter-spacing: 0.02em;
    }
    header span {
      font-size: 0.95rem;
      color: #9aa2b1;
    }
    main {
      flex: 1;
      display: flex;
      gap: 1px;
      background: #1a202c;
      min-height: 0;
    }
    .panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
      background: #0f131a;
    }
    .panel h2 {
      margin: 0;
      padding: 16px 20px;
      font-size: 1rem;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #8f9bb3;
      border-bottom: 1px solid #1f242d;
      background: #11161d;
    }
    textarea {
      flex: 1;
      background: #05070b;
      color: #f5f6f7;
      border: none;
      padding: 20px;
      font-size: 0.95rem;
      font-family: "Fira Code", "JetBrains Mono", "SFMono-Regular", monospace;
      resize: none;
      line-height: 1.5;
      outline: none;
    }
    .preview-wrapper {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }
    iframe {
      flex: 1;
      border: none;
      background: #fff;
    }
    footer {
      padding: 12px 24px;
      border-top: 1px solid #1f242d;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
      color: #9aa2b1;
      background: #11161d;
    }
    .toolbar {
      display: flex;
      gap: 12px;
      padding: 16px 20px;
      border-bottom: 1px solid #1f242d;
      background: #0f131a;
    }
    button {
      background: #2563eb;
      border: none;
      color: #fff;
      padding: 10px 18px;
      border-radius: 6px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s ease, opacity 0.15s ease;
    }
    button.secondary {
      background: #1f2937;
      color: #cbd5f5;
    }
    button:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .status {
      flex: 1;
      text-align: right;
      font-size: 0.85rem;
      color: #8f9bb3;
    }
    @media (max-width: 900px) {
      main {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>VingIde</h1>
      <span>Online IDE and preview for the Ving programming language</span>
    </div>
    <button onclick="downloadHtml()">Download HTML</button>
  </header>
  <main>
    <section class="panel">
      <h2>Editor</h2>
      <div class="toolbar">
        <button onclick="compileNow()">Run</button>
        <button class="secondary" onclick="resetCode()">Reset</button>
        <div class="status" id="status">Ready</div>
      </div>
      <textarea id="editor" spellcheck="false"></textarea>
    </section>
    <section class="panel preview-wrapper">
      <h2>Preview</h2>
      <iframe id="preview"></iframe>
    </section>
  </main>
  <footer>
    <span>VingIde • Build Ving pages directly in your browser</span>
    <span>Auto-compiles as you type · No backend required</span>
  </footer>

  <script>
    const editor = document.getElementById('editor');
    const previewFrame = document.getElementById('preview');
    const statusEl = document.getElementById('status');

    const defaultCode = `style:black

title: VingIde Demo

text(bold,big): Welcome to VingIde
text(): Edit the code on the left and see the preview here.
text(): The Ving syntax is parsed in the browser.

button(st1,link:https://github.com/vingcode/ving):Open Repository

img(big): https://placehold.co/800x360/111827/f5f5f5?text=VingIde

video(controls,width:640,height:360): https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4

audio(controls): https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3

iframe(allowfullscreen,width:560,height:315): https://www.youtube.com/embed/dQw4w9WgXcQ
`;

    editor.value = defaultCode;

    let compileTimeout;
    editor.addEventListener('input', () => {
      statusEl.textContent = 'Editing…';
      clearTimeout(compileTimeout);
      compileTimeout = setTimeout(compileNow, 400);
    });

    function compileNow() {
      try {
        const html = compileVing(editor.value);
        const doc = previewFrame.contentWindow.document;
        doc.open();
        doc.write(html);
        doc.close();
        statusEl.textContent = 'Preview updated · ' + new Date().toLocaleTimeString();
      } catch (error) {
        statusEl.textContent = 'Error: ' + error.message;
        console.error(error);
      }
    }

    function resetCode() {
      editor.value = defaultCode;
      compileNow();
    }

    function downloadHtml() {
      const html = compileVing(editor.value);
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'ving-ide-output.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, char => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;',
      })[char]);
    }

    function parseLine(line) {
      const match = line.match(/^(\w+)(?:\(([^)]*)\))?(?::(.*))?$/);
      if (!match) return null;
      const [, type, params, content] = match;
      const paramList = params ? params.split(',').map(p => p.trim()).filter(Boolean) : [];
      const textContent = content ? content.trim() : '';
      return { type: type.toLowerCase(), params: paramList, content: textContent };
    }

    function compileVing(code) {
      const lines = code.split(/\r?\n/);
      let title = 'Ving Preview';
      let theme = 'light';
      const body = [];

      for (const rawLine of lines) {
        const line = rawLine.trim();
        if (!line || line.startsWith('#')) continue;
        if (line.startsWith('style:')) {
          theme = line.slice(6).trim().toLowerCase() || 'light';
          continue;
        }
        if (line.startsWith('title:')) {
          title = line.slice(6).trim() || 'Ving Preview';
          continue;
        }
        const element = parseLine(line);
        if (!element) continue;
        switch (element.type) {
          case 'text':
            body.push(renderText(element));
            break;
          case 'button':
            body.push(renderButton(element));
            break;
          case 'img':
            body.push(renderImage(element));
            break;
          case 'video':
            body.push(renderVideo(element));
            break;
          case 'audio':
            body.push(renderAudio(element));
            break;
          case 'iframe':
            body.push(renderIframe(element));
            break;
          default:
            body.push(`<p class="ving-text">Unsupported element: ${escapeHtml(element.type)}</p>`);
        }
      }

      return generateHtmlDocument(title, theme, body.join('\n'));
    }

    function renderText({ params, content }) {
      const classes = ['ving-text'];
      params.forEach(param => classes.push(param));
      return `<p class="${classes.join(' ')}">${escapeHtml(content)}</p>`;
    }

    function renderButton({ params, content }) {
      const classes = ['ving-button'];
      let href = null;
      params.forEach(param => {
        if (param.startsWith('link:')) {
          href = param.slice(5);
        } else {
          classes.push(param);
        }
      });
      const text = content || 'Button';
      const buttonHtml = `<button class="${classes.join(' ')}">${escapeHtml(text)}</button>`;
      if (href) {
        return `<a href="${href}" target="_blank" rel="noreferrer">${buttonHtml}</a>`;
      }
      return buttonHtml;
    }

    function renderImage({ params, content }) {
      const classes = ['ving-img'];
      params.forEach(param => classes.push(param));
      return `<img class="${classes.join(' ')}" src="${content}" alt="Ving image" />`;
    }

    function renderVideo({ params, content }) {
      const attrs = [];
      params.forEach(param => {
        if (param.includes(':')) {
          const [key, value] = param.split(':');
          attrs.push(`${key}="${value}"`);
        } else {
          attrs.push(param);
        }
      });
      return `<video class="ving-video" ${attrs.join(' ')}>
        <source src="${content}" type="video/mp4" />
        Your browser does not support the video tag.
      </video>`;
    }

    function renderAudio({ params, content }) {
      const attrs = params.join(' ');
      return `<audio class="ving-audio" ${attrs}>
        <source src="${content}" type="audio/mpeg" />
        Your browser does not support the audio element.
      </audio>`;
    }

    function renderIframe({ params, content }) {
      const attrs = [];
      params.forEach(param => {
        if (param.includes(':')) {
          const [key, value] = param.split(':');
          attrs.push(`${key}="${value}"`);
        } else if (param === 'allowfullscreen') {
          attrs.push('allowfullscreen');
        }
      });
      return `<iframe class="ving-iframe" src="${content}" ${attrs.join(' ')}></iframe>`;
    }

    function generateHtmlDocument(title, theme, body) {
      const isDark = theme === 'black' || theme === 'dark';
      const background = isDark ? '#0f172a' : '#f8fafc';
      const textColor = isDark ? '#e2e8f0' : '#0f172a';
      const containerBg = isDark ? '#111827' : '#ffffff';
      const border = isDark ? 'rgba(148,163,184,0.2)' : 'rgba(15,23,42,0.1)';

      const styles = `body { font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif; background: ${background}; color: ${textColor}; margin: 0; padding: 32px; }
.container { max-width: 960px; margin: 0 auto; background: ${containerBg}; padding: 32px; border-radius: 16px; box-shadow: 0 20px 60px rgba(15,23,42,0.2); border: 1px solid ${border}; }
.ving-text { font-size: 1rem; line-height: 1.6; margin: 1rem 0; }
.ving-text.bold { font-weight: 700; }
.ving-text.italic { font-style: italic; }
.ving-text.big { font-size: 1.4rem; }
.ving-button { padding: 12px 28px; border-radius: 999px; border: none; background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: #fff; font-weight: 600; font-size: 1rem; cursor: pointer; margin: 12px 8px 12px 0; box-shadow: 0 15px 40px rgba(59,130,246,0.25); transition: transform 0.1s ease, opacity 0.2s ease; }
.ving-button:hover { opacity: 0.9; transform: translateY(-1px); }
.ving-img, .ving-video, .ving-iframe { width: 100%; max-width: 100%; border-radius: 16px; margin: 24px 0; border: 1px solid ${border}; box-shadow: 0 15px 45px rgba(15,23,42,0.15); }
.ving-audio { width: 100%; margin: 20px 0; }
a { color: inherit; text-decoration: none; }
a button { margin-right: 0; }`;

      return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>${escapeHtml(title)}</title>
<style>${styles}</style>
</head>
<body>
<div class="container">
${body}
</div>
</body>
</html>`;
    }

    compileNow();
  </script>
</body>
</html>
